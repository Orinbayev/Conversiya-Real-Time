{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
    .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #e2e8f0;
        border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #cbd5e1;
    }
</style>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'currency/css/currency.css' %}">

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

        <!-- Main Table Section -->
        <div class="lg:col-span-2 space-y-8">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="p-8 border-b border-gray-50 flex justify-between items-center bg-white">
                    <h2 class="text-3xl font-extrabold text-gray-900 tracking-tight">Kurs valyut <span
                            class="text-gray-300 font-normal ml-2">{% now "d.m.Y" %}</span></h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50/50 text-gray-400 text-[11px] uppercase tracking-widest font-bold">
                            <tr>
                                <th id="table-th-curr" class="py-5 px-8">Valyuta</th>
                                <th id="table-th-buy" class="py-5 px-8 text-right">Pokupka</th>
                                <th id="table-th-sell" class="py-5 px-8 text-right">Prodaja</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-50">
                            {% for curr in currencies %}
                            <tr class="currency-row hover:bg-blue-50/30 transition-all duration-200 group {% if curr not in highlighted %}hidden-initially{% endif %}"
                                style="{% if curr not in highlighted %}display:none;{% endif %}"
                                data-code="{{ curr.code }}" data-name="{{ curr.name }}">
                                <td class="py-6 px-8">
                                    <div class="flex items-center gap-6">
                                        <div
                                            class="w-12 h-12 rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center border border-gray-200 shadow-inner group-hover:scale-110 transition-transform">
                                            <img src="https://flagcdn.com/w80/{% if curr.code == 'USD' %}us{% elif curr.code == 'EUR' %}eu{% elif curr.code == 'GBP' %}gb{% elif curr.code == 'JPY' %}jp{% elif curr.code == 'KZT' %}kz{% elif curr.code == 'RUB' %}ru{% elif curr.code == 'CHF' %}ch{% elif curr.code == 'UZS' %}uz{% else %}{{ curr.code|slice:':2'|lower }}{% endif %}.png"
                                                class="w-full h-full object-cover"
                                                onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden'); this.nextElementSibling.classList.add('flex');">
                                            <span
                                                class="hidden w-full h-full items-center justify-center text-[10px] font-black text-gray-500 uppercase tracking-tighter bg-gray-100">
                                                {{ curr.code }}
                                            </span>
                                        </div>
                                        <div>
                                            <div class="font-black text-lg text-gray-900">{{ curr.code }}</div>
                                            <div class="text-xs text-gray-400 font-medium">{{ curr.name }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="py-6 px-8 text-right text-gray-900">
                                    <span
                                        class="inline-block bg-green-50 text-green-700 px-3 py-1 rounded-lg font-bold text-lg">
                                        {{ curr.buy_price|default:"-" }}
                                    </span>
                                </td>
                                <td class="py-6 px-8 text-right text-gray-900">
                                    <span
                                        class="inline-block bg-blue-50 text-blue-700 px-3 py-1 rounded-lg font-bold text-lg">
                                        {{ curr.sell_price|default:"-" }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="p-8 bg-gray-50/30 text-[11px] text-gray-400 leading-relaxed max-w-2xl">
                    <p id="table-note-text">* Kursy mogut otlichatsya v moment obmena. Tochnyy kurs obmena budet
                        opredelen na moment
                        soversheniya operatsii v kasse banka.</p>
                </div>
            </div>
        </div>

        <!-- Sidebar Section -->
        <aside class="space-y-10">
            <!-- Converter Widget -->
            <div class="bg-white rounded-2xl shadow-xl shadow-blue-500/5 border border-gray-100 p-8">
                <h3 class="text-gray-900 font-black text-xl mb-6 flex items-center gap-2">
                    <i data-lucide="refresh-cw" class="w-5 h-5 text-blue-500"></i>
                    <span id="conv-title-text">Konverter</span>
                </h3>
                <div class="space-y-6">
                    <div>
                        <label id="conv-label-sell"
                            class="text-[10px] uppercase tracking-widest font-bold text-gray-400 mb-2 block">Hochu
                            prodat</label>
                        <div class="relative group z-50">
                            <input type="number" id="sell-amount" value="1"
                                class="w-full bg-gray-50 border-2 border-transparent group-hover:bg-white group-hover:border-blue-100 rounded-xl p-5 text-2xl font-black text-gray-900 transition-all focus:ring-0 outline-none">
                            <div class="absolute right-4 top-1/2 -translate-y-1/2">
                                <div id="currency-dropdown" class="relative">
                                    <button type="button" id="dropdown-toggle"
                                        class="bg-white border border-gray-100 rounded-lg px-3 py-2 font-black text-xs text-gray-900 shadow-sm flex items-center gap-2 hover:bg-gray-50 transition-all border-2 border-transparent active:border-blue-100">
                                        <span id="selected-currency-text">USD</span>
                                        <i data-lucide="chevron-down" class="w-3 h-3 text-gray-400"></i>
                                    </button>

                                    <div id="dropdown-menu"
                                        class="hidden absolute right-0 mt-2 w-64 bg-white dark:bg-slate-900 border border-gray-100 dark:border-slate-800 rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.15)] z-[60] overflow-hidden transform origin-top-right transition-all border-2 border-blue-50/50 dark:border-blue-900/30">
                                        <div
                                            class="p-4 border-b border-gray-50 dark:border-slate-800 bg-gray-50/50 dark:bg-slate-800/50">
                                            <input type="text" id="currency-search" placeholder="Qidirish..."
                                                class="w-full px-4 py-2.5 text-xs bg-white dark:bg-slate-900 border-2 border-gray-100 dark:border-slate-700 rounded-xl focus:border-blue-500 focus:ring-0 outline-none font-bold transition-all text-gray-900 dark:text-gray-100">
                                        </div>
                                        <div id="currency-list"
                                            class="max-h-64 overflow-y-auto p-2 custom-scrollbar space-y-1">
                                            {% for curr in currencies %}<button type="button"
                                                class="currency-option w-full text-left px-4 py-3 rounded-xl text-xs font-black text-gray-700 hover:bg-blue-600 hover:text-white transition-all flex justify-between items-center group"
                                                data-code="{{ curr.code }}" data-buy="{{ curr.buy_price }}"
                                                data-sell="{{ curr.sell_price }}">
                                                <span class="text-gray-900 dark:text-gray-100">{{ curr.code }}</span>
                                                <span
                                                    class="text-[9px] text-gray-400 dark:text-gray-500 font-bold group-hover:text-blue-100 transition-colors uppercase">
                                                    {{ curr.name }}
                                                </span></button>{% endfor %}
                                        </div>
                                    </div>
                                </div>
                                <select id="sell-currency" class="hidden">
                                    {% for curr in currencies %}
                                    <option value="{{ curr.code }}" data-buy="{{ curr.buy_price }}"
                                        data-sell="{{ curr.sell_price }}">{{ curr.code }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-center -my-3 group relative z-40">
                        <button id="swap-btn"
                            class="p-3 rounded-full bg-blue-600 text-white shadow-lg shadow-blue-500/30 hover:rotate-180 transition-all duration-500 active:scale-95">
                            <i data-lucide="arrow-down-up" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <div>
                        <label id="conv-label-get"
                            class="text-[10px] uppercase tracking-widest font-bold text-gray-400 mb-2 block">Poluchu</label>
                        <div class="relative z-30">
                            <input type="text" id="get-amount" readonly
                                class="w-full bg-blue-50/30 border-2 border-blue-50 rounded-xl p-5 text-2xl font-black text-blue-600 outline-none">
                            <span class="absolute right-6 top-1/2 -translate-y-1/2 font-black text-blue-300">UZS</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Widget -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                <h3 id="archive-title" class="text-gray-400 font-bold text-xs uppercase tracking-widest mb-6">Arxiv
                    kursov</h3>
                <div id="calendar-container">
                    <div class="flex justify-between items-center mb-6">
                        <button id="prev-month"
                            class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-50 text-gray-400 transition-colors">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                        </button>
                        <button id="current-month-btn" class="flex-grow text-center group">
                            <span id="current-month-display"
                                class="font-black text-sm text-gray-900 uppercase tracking-tighter group-hover:text-blue-600 transition-colors"></span>
                        </button>
                        <button id="next-month"
                            class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-50 text-gray-400 transition-colors">
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div id="calendar-weekdays"
                        class="grid grid-cols-7 gap-2 text-center text-[10px] font-bold uppercase text-gray-400 mb-2">
                        <!-- Weekdays will be rendered here by JS -->
                    </div>
                    <div id="calendar-days" class="grid grid-cols-7 gap-1 text-center text-xs font-bold text-gray-700">
                        <!-- Days will be rendered here by JS -->
                    </div>
                </div>
            </div>
        </aside>

    </div>
</div>

<script src="{% static 'currency/js/currency.js' %}"></script>
{% endblock %}